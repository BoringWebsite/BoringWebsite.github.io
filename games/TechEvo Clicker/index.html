<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TechEvo Clicker</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <button class="reset-button" id="resetButton" title="Reset All Progress">
      üóëÔ∏è
    </button>
    <button
      class="privacy-button"
      id="privacyButton"
      title="Privacy Information"
    >
      üîí
    </button>

    <!-- Privacy Modal -->
    <div class="privacy-modal" id="privacyModal">
      <div class="privacy-content">
        <button class="privacy-close" id="privacyClose">√ó</button>
        <h2>üîí Privacy & Data Storage</h2>
        <p><strong>Your privacy is important to us!</strong></p>

        <p>
          This game uses <strong>local storage</strong> to save your progress
          directly on your device. Here's what you need to know:
        </p>

        <ul>
          <li>
            <strong>What we store:</strong> Only your game progress (points,
            upgrades, prestige levels)
          </li>
          <li>
            <strong>Where it's stored:</strong> Locally on your device only -
            never sent to any servers
          </li>
          <li>
            <strong>Who can access it:</strong> Only you, on this device and
            browser
          </li>
          <li>
            <strong>No tracking:</strong> We don't track your activity or
            collect personal information
          </li>
          <li>
            <strong>No cookies:</strong> We don't use cookies for tracking or
            advertising
          </li>
        </ul>

        <p>
          You can clear your saved data anytime using the reset button (üóëÔ∏è) or
          by clearing your browser's local storage.
        </p>

        <p>
          <strong
            >This storage is essential for the game to remember your progress
            between sessions.</strong
          >
        </p>
      </div>
    </div>

    <h1>üöÄ Tech Evolution Clicker</h1>
    <p class="subtitle">Click to advance human technology through the ages!</p>

    <div class="game-container">
      <div class="main-area">
        <div class="stats">
          <div class="points-display" id="points">0 Innovation Points</div>
          <div class="pps-display" id="pps">0 points per second</div>
          <div class="era-display">
            <div class="era-name" id="eraName">üóø Stone Age</div>
            <div class="era-progress-container" id="eraProgressContainer">
              <div class="era-progress-label" id="eraProgressLabel">
                Progress to Neolithic
              </div>
              <div class="era-progress-bar">
                <div class="era-progress-fill" id="eraProgressFill"></div>
                <div class="era-progress-text" id="eraProgressText">0%</div>
              </div>
            </div>
          </div>
        </div>

        <button class="click-area" id="clickButton">üî•</button>

        <div id="clickText">
          <h3>Discovery Station</h3>
          <p>Click to make groundbreaking discoveries!</p>
        </div>
      </div>

      <div class="upgrades">
        <h3 style="margin-bottom: 15px">üõ†Ô∏è Technological Upgrades</h3>

        <div class="upgrade-tabs">
          <button class="tab-button active" id="normalTab">üî¨ Research</button>
          <button class="tab-button" id="specialTab">‚≠ê Special</button>
          <button class="tab-button" id="prestigeTab">üëë Prestige</button>
        </div>

        <div class="tab-content active" id="normalContent">
          <div id="normalUpgradesList"></div>
        </div>

        <div class="tab-content" id="specialContent">
          <div id="specialUpgradesList"></div>
        </div>

        <div class="tab-content" id="prestigeContent">
          <div id="prestigeInfo"></div>
        </div>
      </div>
    </div>

    <script>
      class TechClickerGame {
        constructor() {
          this.points = 0;
          this.pointsPerSecond = 0;
          this.clickPower = 1;
          this.highestEraReached = 0; // Track the highest era index reached
          this.luckLevel = 0; // Track luck upgrade level
          this.efficiencyLevel = 0; // Track efficiency upgrade level
          this.automationLevel = 0; // Track automation upgrade level
          this.multiplierLevel = 0; // Track multiplier upgrade level
          this.timeWarpLevel = 0; // Track time warp upgrade level
          this.activeTab = "normal"; // Track which tab is active
          this.prestigeCount = 0; // Track number of prestiges
          this.prestigeRequirement = 15000000; // Cost to prestige (1.5x final upgrade cost)

          this.upgrades = [
            {
              id: "wheel",
              name: "‚ö´ The Wheel",
              description:
                "Revolutionary circular invention that changed transportation forever. Around 3500 BCE, this simple yet genius device reduced friction and made moving heavy objects much easier.",
              baseCost: 10,
              pointsPerSecond: 0.1,
              owned: 0,
              era: "Stone Age",
            },
            {
              id: "fire",
              name: "üî• Controlled Fire",
              description:
                "Mastery over fire marked the beginning of cooking, metalworking, and protection from predators. This discovery, dating back 1.7 million years, was crucial for human survival.",
              baseCost: 25,
              pointsPerSecond: 0.3,
              owned: 0,
              era: "Stone Age",
            },
            {
              id: "luck",
              name: "üçÄ Lucky Discovery",
              description:
                "Sometimes the greatest breakthroughs happen by accident! Each level increases your chance of making a serendipitous discovery while clicking by 1%. Bonus scales with your current era!",
              baseCost: 50,
              pointsPerSecond: 0,
              owned: 0,
              era: "Stone Age",
              isSpecial: true,
            },
            {
              id: "efficiency",
              name: "‚ö° Efficiency Engine",
              description:
                "Optimize your research processes! Each level increases ALL upgrade effectiveness by 2%. This compounds with itself, making later upgrades much more powerful!",
              baseCost: 500,
              pointsPerSecond: 0,
              owned: 0,
              era: "Industrial Age",
              isSpecial: true,
            },
            {
              id: "automation",
              name: "ü§ñ Research Automation",
              description:
                "Automate your discovery process! Each level gives you 0.5% of your current points per second as bonus points per click. More progress = stronger clicks!",
              baseCost: 2500,
              pointsPerSecond: 0,
              owned: 0,
              era: "Digital Age",
              isSpecial: true,
            },
            {
              id: "multiplier",
              name: "üéØ Focus Multiplier",
              description:
                "Channel your focus for breakthrough moments! Each level gives a 1% chance per click to gain 10x points for that click. Stack with luck for incredible combos!",
              baseCost: 10000,
              pointsPerSecond: 0,
              owned: 0,
              era: "Information Age",
              isSpecial: true,
            },
            {
              id: "timeWarp",
              name: "‚è∞ Time Acceleration",
              description:
                "Bend time itself to accelerate research! Each level increases your points per second by 5% of your total click power. Active clicking becomes more valuable!",
              baseCost: 50000,
              pointsPerSecond: 0,
              owned: 0,
              era: "AI Age",
              isSpecial: true,
            },
            {
              id: "agriculture",
              name: "üåæ Agriculture",
              description:
                "The Neolithic Revolution (~10,000 BCE) allowed humans to settle and form civilizations. Growing crops instead of hunting-gathering changed everything.",
              baseCost: 100,
              pointsPerSecond: 1,
              owned: 0,
              era: "Neolithic",
            },
            {
              id: "writing",
              name: "üìú Writing System",
              description:
                "Cuneiform and hieroglyphics (~3200 BCE) allowed humans to record information, laws, and stories. Knowledge could now be preserved across generations.",
              baseCost: 250,
              pointsPerSecond: 2.5,
              owned: 0,
              era: "Bronze Age",
            },
            {
              id: "bronze",
              name: "üî® Bronze Working",
              description:
                "Combining copper and tin (~3300 BCE) created stronger tools and weapons. The Bronze Age began, revolutionizing craftsmanship and warfare.",
              baseCost: 500,
              pointsPerSecond: 5,
              owned: 0,
              era: "Bronze Age",
            },
            {
              id: "iron",
              name: "‚öîÔ∏è Iron Smelting",
              description:
                "Iron working (~1500 BCE) produced even stronger materials than bronze. Better tools, weapons, and farming equipment followed.",
              baseCost: 1000,
              pointsPerSecond: 10,
              owned: 0,
              era: "Iron Age",
            },
            {
              id: "printing",
              name: "üìñ Printing Press",
              description:
                "Gutenberg's invention (1440 CE) democratized knowledge. Books became affordable, spreading literacy and accelerating the Renaissance.",
              baseCost: 2500,
              pointsPerSecond: 25,
              owned: 0,
              era: "Renaissance",
            },
            {
              id: "steam",
              name: "üöÇ Steam Engine",
              description:
                "James Watt's improvements (1769) powered the Industrial Revolution. Factories, trains, and ships transformed society and economics.",
              baseCost: 5000,
              pointsPerSecond: 50,
              owned: 0,
              era: "Industrial Age",
            },
            {
              id: "electricity",
              name: "‚ö° Electricity",
              description:
                "Tesla and Edison's work brought power to homes and factories. The late 1800s saw the birth of the modern electrical world.",
              baseCost: 10000,
              pointsPerSecond: 100,
              owned: 0,
              era: "Industrial Age",
            },
            {
              id: "telephone",
              name: "üìû Telephone",
              description:
                "Bell's 1876 invention revolutionized communication. For the first time, people could talk across vast distances instantly.",
              baseCost: 25000,
              pointsPerSecond: 250,
              owned: 0,
              era: "Industrial Age",
            },
            {
              id: "automobile",
              name: "üöó Automobile",
              description:
                "Ford's assembly line (1913) made cars affordable for everyone. Personal transportation transformed cities and society.",
              baseCost: 50000,
              pointsPerSecond: 500,
              owned: 0,
              era: "Industrial Age",
            },
            {
              id: "airplane",
              name: "‚úàÔ∏è Airplane",
              description:
                "The Wright Brothers' 1903 flight made the world smaller. Aviation connected continents and made global travel possible.",
              baseCost: 100000,
              pointsPerSecond: 1000,
              owned: 0,
              era: "Modern Age",
            },
            {
              id: "computer",
              name: "üíª Computer",
              description:
                "ENIAC (1946) and early computers laid the groundwork for the digital age. Calculating machines became thinking machines.",
              baseCost: 250000,
              pointsPerSecond: 2500,
              owned: 0,
              era: "Digital Age",
            },
            {
              id: "transistor",
              name: "üî¨ Transistor",
              description:
                "Bell Labs' 1947 invention replaced vacuum tubes. This tiny switch enabled everything from radios to smartphones.",
              baseCost: 500000,
              pointsPerSecond: 5000,
              owned: 0,
              era: "Digital Age",
            },
            {
              id: "internet",
              name: "üåê Internet",
              description:
                "ARPANET (1969) evolved into the World Wide Web. Tim Berners-Lee's 1989 creation connected humanity like never before.",
              baseCost: 1000000,
              pointsPerSecond: 10000,
              owned: 0,
              era: "Information Age",
            },
            {
              id: "smartphone",
              name: "üì± Smartphone",
              description:
                "The iPhone (2007) put a computer in everyone's pocket. Mobile computing changed how we work, learn, and connect.",
              baseCost: 2500000,
              pointsPerSecond: 25000,
              owned: 0,
              era: "Information Age",
            },
            {
              id: "ai",
              name: "ü§ñ Artificial Intelligence",
              description:
                "Machine learning and neural networks are creating intelligent systems. AI is beginning to augment and enhance human capabilities.",
              baseCost: 5000000,
              pointsPerSecond: 50000,
              owned: 0,
              era: "AI Age",
            },
            {
              id: "quantum",
              name: "‚öõÔ∏è Quantum Computing",
              description:
                "Quantum computers use quantum mechanics to solve problems impossible for classical computers. The future of computing is quantum.",
              baseCost: 10000000,
              pointsPerSecond: 100000,
              owned: 0,
              era: "Quantum Age",
            },
          ];

          this.eras = [
            { name: "Stone Age", threshold: 0, icon: "üóø" },
            { name: "Neolithic", threshold: 100, icon: "üåæ" },
            { name: "Bronze Age", threshold: 500, icon: "üî®" },
            { name: "Iron Age", threshold: 2000, icon: "‚öîÔ∏è" },
            { name: "Renaissance", threshold: 10000, icon: "üé®" },
            { name: "Industrial Age", threshold: 50000, icon: "üè≠" },
            { name: "Modern Age", threshold: 250000, icon: "üöÄ" },
            { name: "Digital Age", threshold: 1000000, icon: "üíª" },
            { name: "Information Age", threshold: 5000000, icon: "üåê" },
            { name: "AI Age", threshold: 25000000, icon: "ü§ñ" },
            { name: "Quantum Age", threshold: 100000000, icon: "‚öõÔ∏è" },
          ];

          this.init();
        }

        init() {
          this.loadGame();
          this.setupEventListeners();
          this.renderUpgrades();
          this.updateDisplay();
          this.startAutoSave();
          this.startPointsPerSecond();
        }

        setupEventListeners() {
          document
            .getElementById("clickButton")
            .addEventListener("click", (e) => this.handleClick(e));
          document
            .getElementById("normalUpgradesList")
            .addEventListener("click", (e) => this.handleUpgradeClick(e));
          document
            .getElementById("specialUpgradesList")
            .addEventListener("click", (e) => this.handleUpgradeClick(e));
          document
            .getElementById("normalTab")
            .addEventListener("click", () => this.switchTab("normal"));
          document
            .getElementById("specialTab")
            .addEventListener("click", () => this.switchTab("special"));
          document
            .getElementById("prestigeTab")
            .addEventListener("click", () => this.switchTab("prestige"));
          document
            .getElementById("resetButton")
            .addEventListener("click", () => this.confirmReset());
          document
            .getElementById("privacyButton")
            .addEventListener("click", () => this.showPrivacyModal());
          document
            .getElementById("privacyClose")
            .addEventListener("click", () => this.hidePrivacyModal());
          document
            .getElementById("privacyModal")
            .addEventListener("click", (e) => {
              if (e.target.id === "privacyModal") this.hidePrivacyModal();
            });
        }

        handleClick(e) {
          const prestigeBonus = this.getPrestigeBonus();
          const efficiencyBonus = this.getEfficiencyBonus();
          const automationBonus = this.getAutomationBonus();

          let basePower = Math.floor(this.clickPower * prestigeBonus);
          let pointsGained = basePower;
          let isLucky = false;
          let isMultiplied = false;

          // Apply automation bonus (0.5% of PPS per level)
          if (this.automationLevel > 0) {
            const autoBonus = Math.floor(
              this.pointsPerSecond * (this.automationLevel * 0.005)
            );
            pointsGained += autoBonus;
          }

          // Check for luck bonus (1% per level, max 50%)
          if (this.luckLevel > 0) {
            const luckChance = Math.min(this.luckLevel * 1, 50); // 1% per level, max 50%
            if (Math.random() * 100 < luckChance) {
              const era = this.getCurrentEra();
              const eraIndex = this.eras.findIndex((e) => e.name === era.name);
              const bonusMultiplier = Math.max(1, eraIndex + 1); // Era-based multiplier
              const luckyBonus = Math.floor(
                basePower *
                  bonusMultiplier *
                  (2 + Math.floor(this.luckLevel / 10)) *
                  efficiencyBonus
              );
              pointsGained += luckyBonus;
              isLucky = true;

              // Show special lucky effect
              this.showFloatingText(
                e.target,
                `üçÄ LUCKY! +${luckyBonus}`,
                "#feca57"
              );
            }
          }

          // Check for multiplier bonus (1% chance per level for 10x points)
          if (this.multiplierLevel > 0) {
            const multiplierChance = this.multiplierLevel * 1; // 1% per level
            if (Math.random() * 100 < multiplierChance) {
              pointsGained *= 10;
              isMultiplied = true;

              // Show special multiplier effect
              this.showFloatingText(
                e.target,
                `üéØ 10X MULTIPLIER! √ó${pointsGained}`,
                "#ff6b6b"
              );
            }
          }

          // Apply efficiency bonus to final points
          pointsGained = Math.floor(pointsGained * efficiencyBonus);

          this.points += pointsGained;
          this.updateDisplay();
          this.showFloatingText(
            e.target,
            `+${Math.floor(basePower * efficiencyBonus)}`,
            isLucky || isMultiplied ? "#4ecdc4" : "#4ecdc4"
          );
          this.createClickEffects(e, isLucky, isMultiplied);
          this.saveGame();
        }

        handleUpgradeClick(e) {
          const upgradeElement = e.target.closest(".upgrade-item");
          if (!upgradeElement) return;

          const upgradeId = upgradeElement.dataset.upgradeId;
          this.buyUpgrade(upgradeId);
        }

        buyUpgrade(upgradeId) {
          const upgrade = this.upgrades.find((u) => u.id === upgradeId);
          if (!upgrade) return;

          // Check if upgrade is unlocked (era requirement)
          if (!this.isUpgradeUnlocked(upgrade)) {
            this.showFloatingText(
              document.getElementById("clickButton"),
              `üîí Requires ${upgrade.era}!`,
              "#ff6b6b"
            );
            return;
          }

          const cost = this.getUpgradeCost(upgrade);
          if (this.points >= cost) {
            this.points -= cost;
            upgrade.owned++;

            if (upgrade.isSpecial) {
              // Update special upgrade levels
              switch (upgrade.id) {
                case "luck":
                  this.luckLevel = upgrade.owned;
                  break;
                case "efficiency":
                  this.efficiencyLevel = upgrade.owned;
                  break;
                case "automation":
                  this.automationLevel = upgrade.owned;
                  break;
                case "multiplier":
                  this.multiplierLevel = upgrade.owned;
                  break;
                case "timeWarp":
                  this.timeWarpLevel = upgrade.owned;
                  this.recalculatePointsPerSecond(); // Recalculate PPS when time warp changes
                  break;
              }
            } else {
              const prestigeBonus = this.getPrestigeBonus();
              const efficiencyBonus = this.getEfficiencyBonus();
              this.pointsPerSecond +=
                upgrade.pointsPerSecond * prestigeBonus * efficiencyBonus;
            }

            this.updateDisplay();
            this.saveGame();
          }
        }

        getUpgradeCost(upgrade) {
          // Special upgrades have much higher cost scaling (1.5x vs 1.15x for normal)
          const multiplier = upgrade.isSpecial ? 1.5 : 1.15;
          return Math.floor(
            upgrade.baseCost * Math.pow(multiplier, upgrade.owned)
          );
        }

        switchTab(tabName) {
          this.activeTab = tabName;

          // Update tab buttons
          document.getElementById("normalTab").classList.remove("active");
          document.getElementById("specialTab").classList.remove("active");
          document.getElementById("prestigeTab").classList.remove("active");
          document.getElementById(tabName + "Tab").classList.add("active");

          // Update tab content
          document.getElementById("normalContent").classList.remove("active");
          document.getElementById("specialContent").classList.remove("active");
          document.getElementById("prestigeContent").classList.remove("active");
          document.getElementById(tabName + "Content").classList.add("active");

          // Render prestige content if needed
          if (tabName === "prestige") {
            this.renderPrestige();
          }
        }

        getPrestigeBonus() {
          // Each prestige gives +10% to click power and points per second
          return 1 + this.prestigeCount * 0.1;
        }

        getEfficiencyBonus() {
          // Each efficiency level gives +2% to all upgrades (multiplicative)
          return Math.pow(1.02, this.efficiencyLevel);
        }

        getAutomationBonus() {
          // Automation gives 0.5% of PPS as bonus click power
          return this.automationLevel * 0.005 * this.pointsPerSecond;
        }

        isUpgradeUnlocked(upgrade) {
          // Check if the player has reached the required era for this upgrade
          const currentEra = this.getCurrentEra();
          const currentEraIndex = this.eras.findIndex(
            (era) => era.name === currentEra.name
          );
          const requiredEraIndex = this.eras.findIndex(
            (era) => era.name === upgrade.era
          );

          return currentEraIndex >= requiredEraIndex;
        }

        recalculatePointsPerSecond() {
          // Recalculate PPS from scratch including all bonuses
          const prestigeBonus = this.getPrestigeBonus();
          const efficiencyBonus = this.getEfficiencyBonus();

          let totalPPS = 0;
          this.upgrades.forEach((upgrade) => {
            if (!upgrade.isSpecial && upgrade.owned > 0) {
              totalPPS +=
                upgrade.pointsPerSecond *
                upgrade.owned *
                prestigeBonus *
                efficiencyBonus;
            }
          });

          // Add time warp bonus (5% of click power per level)
          if (this.timeWarpLevel > 0) {
            const timeWarpBonus =
              this.clickPower * prestigeBonus * (this.timeWarpLevel * 0.05);
            totalPPS += timeWarpBonus;
          }

          this.pointsPerSecond = totalPPS;
        }

        canPrestige() {
          return this.points >= this.prestigeRequirement;
        }

        doPrestige() {
          if (!this.canPrestige()) return;

          // Increment prestige count
          this.prestigeCount++;

          // Reset game state
          this.points = 0;
          this.pointsPerSecond = 0;
          this.highestEraReached = 0;
          this.luckLevel = 0;
          this.efficiencyLevel = 0;
          this.automationLevel = 0;
          this.multiplierLevel = 0;
          this.timeWarpLevel = 0;

          // Reset all upgrades
          this.upgrades.forEach((upgrade) => {
            upgrade.owned = 0;
          });

          // Update display
          this.updateDisplay();
          this.saveGame();

          // Show prestige effect
          this.showFloatingText(
            document.getElementById("clickButton"),
            `üéâ PRESTIGE ${this.prestigeCount}! +${
              this.prestigeCount * 10
            }% BONUS!`,
            "#feca57"
          );
        }

        confirmReset() {
          const confirmed = confirm(
            "Are you sure you want to reset ALL progress?\n\nThis will delete:\n‚Ä¢ All Innovation Points\n‚Ä¢ All Upgrades\n‚Ä¢ All Prestige levels\n‚Ä¢ Era progress\n\nThis action cannot be undone!"
          );

          if (confirmed) {
            this.resetAllProgress();
          }
        }

        resetAllProgress() {
          // Reset everything to initial state
          this.points = 0;
          this.pointsPerSecond = 0;
          this.clickPower = 1;
          this.highestEraReached = 0;
          this.luckLevel = 0;
          this.efficiencyLevel = 0;
          this.automationLevel = 0;
          this.multiplierLevel = 0;
          this.timeWarpLevel = 0;
          this.activeTab = "normal";
          this.prestigeCount = 0;

          // Reset all upgrades
          this.upgrades.forEach((upgrade) => {
            upgrade.owned = 0;
          });

          // Clear save data
          localStorage.removeItem("techClickerSave");

          // Reset to normal tab
          this.switchTab("normal");

          // Update display
          this.updateDisplay();

          // Show reset confirmation
          this.showFloatingText(
            document.getElementById("clickButton"),
            "üóëÔ∏è RESET COMPLETE!",
            "#ff6b6b"
          );
        }

        showPrivacyModal() {
          document.getElementById("privacyModal").classList.add("show");
        }

        hidePrivacyModal() {
          document.getElementById("privacyModal").classList.remove("show");
        }

        renderPrestige() {
          const prestigeInfo = document.getElementById("prestigeInfo");
          const canPrestige = this.canPrestige();
          const prestigeBonus = Math.round((this.getPrestigeBonus() - 1) * 100);

          prestigeInfo.innerHTML = `
            <div class="prestige-section">
              <h3>üëë Prestige System</h3>
              <div class="prestige-stats">
                <div class="prestige-count">Prestiges: ${
                  this.prestigeCount
                }</div>
                <div class="prestige-bonus">Current Bonus: +${prestigeBonus}% to all production</div>
              </div>
              <button class="prestige-button" ${
                !canPrestige ? "disabled" : ""
              } onclick="game.doPrestige()">
                ${canPrestige ? "PRESTIGE NOW!" : "Prestige Locked"}
              </button>
              <div class="prestige-requirement">
                ${
                  canPrestige
                    ? "Reset all progress but gain +10% permanent bonus!"
                    : `Requires ${this.prestigeRequirement.toLocaleString()} Innovation Points`
                }
              </div>
              <div style="margin-top: 20px; font-size: 14px; color: rgba(255,255,255,0.7);">
                Prestiging resets all upgrades and progress but gives a permanent 10% bonus to click power and points per second for each prestige level.
              </div>
            </div>
          `;
        }

        getCurrentEra() {
          // Check if we've reached a new era
          for (let i = this.eras.length - 1; i >= 0; i--) {
            if (
              this.points >= this.eras[i].threshold &&
              i > this.highestEraReached
            ) {
              this.highestEraReached = i;
              break;
            }
          }

          // Return the highest era reached (never go backwards)
          return this.eras[this.highestEraReached];
        }

        getNextEra() {
          // Return the next era after the current highest reached
          const nextIndex = this.highestEraReached + 1;
          return nextIndex < this.eras.length ? this.eras[nextIndex] : null;
        }

        createClickEffects(e, isLucky = false, isMultiplied = false) {
          const button = e.target;
          const rect = button.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;

          // Create ripple effect (golden if lucky, red if multiplied)
          const ripple = document.createElement("div");
          ripple.className = "click-ripple";
          ripple.style.width = "50px";
          ripple.style.height = "50px";
          ripple.style.left = `${centerX - 25}px`;
          ripple.style.top = `${centerY - 25}px`;

          if (isLucky && isMultiplied) {
            ripple.style.background =
              "radial-gradient(circle, rgba(255, 107, 107, 0.9) 0%, rgba(254, 202, 87, 0.8) 50%, transparent 70%)";
            ripple.style.transform = "scale(2)";
          } else if (isLucky) {
            ripple.style.background =
              "radial-gradient(circle, rgba(254, 202, 87, 0.8) 0%, transparent 70%)";
            ripple.style.transform = "scale(1.5)";
          } else if (isMultiplied) {
            ripple.style.background =
              "radial-gradient(circle, rgba(255, 107, 107, 0.9) 0%, transparent 70%)";
            ripple.style.transform = "scale(1.8)";
          }

          document.body.appendChild(ripple);

          // Create collection icon effect
          const era = this.getCurrentEra();
          const collectionIcon = document.createElement("div");
          collectionIcon.className = "collection-icon";

          if (isLucky && isMultiplied) {
            collectionIcon.textContent = "üíé"; // Diamond for combo
          } else if (isLucky) {
            collectionIcon.textContent = "üçÄ";
          } else if (isMultiplied) {
            collectionIcon.textContent = "üéØ";
          } else {
            collectionIcon.textContent = era.icon;
          }

          collectionIcon.style.left = `${e.clientX - 12}px`;
          collectionIcon.style.top = `${e.clientY - 12}px`;

          if (isLucky || isMultiplied) {
            collectionIcon.style.fontSize = "32px";
            if (isLucky && isMultiplied) {
              collectionIcon.style.filter =
                "drop-shadow(0 0 15px #ff6b6b) drop-shadow(0 0 10px #feca57)";
            } else if (isLucky) {
              collectionIcon.style.filter = "drop-shadow(0 0 10px #feca57)";
            } else {
              collectionIcon.style.filter = "drop-shadow(0 0 10px #ff6b6b)";
            }
          }

          document.body.appendChild(collectionIcon);

          // Clean up elements
          setTimeout(() => {
            document.body.removeChild(ripple);
          }, 600);

          setTimeout(() => {
            document.body.removeChild(collectionIcon);
          }, 2000);

          // Add screen shake effect
          button.style.animation = "none";
          setTimeout(() => {
            button.style.animation = "buttonShake 0.2s ease-in-out";
          }, 10);
        }

        updateDisplay() {
          document.getElementById("points").textContent = `${Math.floor(
            this.points
          ).toLocaleString()} Innovation Points`;
          document.getElementById(
            "pps"
          ).textContent = `${this.pointsPerSecond.toFixed(
            1
          )} points per second`;

          const era = this.getCurrentEra();
          const nextEra = this.getNextEra();

          // Update era name
          document.getElementById(
            "eraName"
          ).textContent = `${era.icon} ${era.name}`;

          // Update era progress bar
          const progressContainer = document.getElementById(
            "eraProgressContainer"
          );
          const progressLabel = document.getElementById("eraProgressLabel");
          const progressFill = document.getElementById("eraProgressFill");
          const progressText = document.getElementById("eraProgressText");

          if (nextEra) {
            // Show progress bar if there's a next era
            progressContainer.style.display = "block";

            // Calculate progress based on current points towards the next era threshold
            // This shows immediate progress from 0% when you start progressing toward the next era
            const progressPercent = Math.min(
              (this.points / nextEra.threshold) * 100,
              100
            );

            // Update progress bar
            const oldWidth = parseFloat(progressFill.style.width) || 0;
            progressFill.style.width = `${progressPercent}%`;
            progressText.textContent = `${progressPercent.toFixed(1)}%`;
            progressLabel.textContent = `Progress to ${nextEra.name}`;

            // Add glow effect if progress increased significantly
            if (progressPercent > oldWidth + 1) {
              progressFill.classList.add("progress-boost");
              setTimeout(() => {
                progressFill.classList.remove("progress-boost");
              }, 800);
            }
          } else {
            // Hide progress bar if at final era
            progressContainer.style.display = "none";
          }

          // Update click button icon based on era
          const clickButton = document.getElementById("clickButton");
          clickButton.textContent = era.icon;

          // Update upgrade affordability highlighting
          this.renderUpgrades();
        }

        renderUpgrades() {
          const normalUpgradesList =
            document.getElementById("normalUpgradesList");
          const specialUpgradesList = document.getElementById(
            "specialUpgradesList"
          );
          normalUpgradesList.innerHTML = "";
          specialUpgradesList.innerHTML = "";

          let hasLockedNormalUpgrades = false;
          let hasLockedSpecialUpgrades = false;

          this.upgrades.forEach((upgrade) => {
            const isUnlocked = this.isUpgradeUnlocked(upgrade);

            // Skip locked upgrades entirely - don't render them
            if (!isUnlocked) {
              // Track if there are locked upgrades for the "more upgrades" message
              if (upgrade.isSpecial) {
                hasLockedSpecialUpgrades = true;
              } else {
                hasLockedNormalUpgrades = true;
              }
              return;
            }

            const cost = this.getUpgradeCost(upgrade);
            const canAfford = this.points >= cost;

            const upgradeElement = document.createElement("div");

            // Determine CSS classes based on affordability (all shown upgrades are unlocked)
            let cssClasses = "upgrade-item";
            if (canAfford) {
              cssClasses += " affordable";
            } else {
              cssClasses += " unaffordable";
            }

            upgradeElement.className = cssClasses;
            upgradeElement.dataset.upgradeId = upgrade.id;

            const ownershipIcons = this.generateOwnershipIcons(upgrade);

            let upgradeInfo = "";
            if (upgrade.isSpecial) {
              switch (upgrade.id) {
                case "luck":
                  const currentChance = Math.min(upgrade.owned * 1, 50);
                  const nextChance = Math.min((upgrade.owned + 1) * 1, 50);
                  upgradeInfo = `Owned: ${upgrade.owned} | Luck Chance: ${currentChance}% ‚Üí ${nextChance}%`;
                  break;
                case "efficiency":
                  const currentEff = Math.round(
                    (Math.pow(1.02, upgrade.owned) - 1) * 100
                  );
                  const nextEff = Math.round(
                    (Math.pow(1.02, upgrade.owned + 1) - 1) * 100
                  );
                  upgradeInfo = `Owned: ${upgrade.owned} | Efficiency: +${currentEff}% ‚Üí +${nextEff}%`;
                  break;
                case "automation":
                  const currentAuto = (upgrade.owned * 0.5).toFixed(1);
                  const nextAuto = ((upgrade.owned + 1) * 0.5).toFixed(1);
                  upgradeInfo = `Owned: ${upgrade.owned} | PPS Bonus: ${currentAuto}% ‚Üí ${nextAuto}%`;
                  break;
                case "multiplier":
                  const currentMult = upgrade.owned;
                  const nextMult = upgrade.owned + 1;
                  upgradeInfo = `Owned: ${upgrade.owned} | 10x Chance: ${currentMult}% ‚Üí ${nextMult}%`;
                  break;
                case "timeWarp":
                  const currentWarp = (upgrade.owned * 5).toFixed(0);
                  const nextWarp = ((upgrade.owned + 1) * 5).toFixed(0);
                  upgradeInfo = `Owned: ${upgrade.owned} | Click‚ÜíPPS: ${currentWarp}% ‚Üí ${nextWarp}%`;
                  break;
                default:
                  upgradeInfo = `Owned: ${upgrade.owned}`;
              }
            } else {
              upgradeInfo = `Owned: ${upgrade.owned} | +${upgrade.pointsPerSecond}/sec each`;
            }

            upgradeElement.innerHTML = `
                        <div class="upgrade-name">${upgrade.name}</div>
                        <div class="upgrade-description">${
                          upgrade.description
                        }</div>
                        <div class="upgrade-cost">Cost: ${cost.toLocaleString()} points</div>
                        <div class="upgrade-owned">${upgradeInfo}</div>
                        <div class="upgrade-icons">${ownershipIcons}</div>
                    `;

            // Add to appropriate tab
            if (upgrade.isSpecial) {
              specialUpgradesList.appendChild(upgradeElement);
            } else {
              normalUpgradesList.appendChild(upgradeElement);
            }
          });

          // Check if we're not at the final era to show "more upgrades" message
          const currentEra = this.getCurrentEra();
          const isFinalEra =
            this.eras[this.eras.length - 1].name === currentEra.name;

          // Add "more upgrades to be unlocked" message if not at final era
          if (!isFinalEra) {
            if (hasLockedNormalUpgrades) {
              const moreUpgradesMessage = document.createElement("div");
              moreUpgradesMessage.className = "more-upgrades-message";
              moreUpgradesMessage.innerHTML =
                "üîÆ More upgrades to be unlocked in future eras...";
              normalUpgradesList.appendChild(moreUpgradesMessage);
            }

            if (hasLockedSpecialUpgrades) {
              const moreSpecialMessage = document.createElement("div");
              moreSpecialMessage.className = "more-upgrades-message";
              moreSpecialMessage.innerHTML =
                "‚≠ê More special upgrades to be unlocked in future eras...";
              specialUpgradesList.appendChild(moreSpecialMessage);
            }
          }
        }

        generateOwnershipIcons(upgrade) {
          if (upgrade.owned === 0) return "";

          let iconsHtml = "";
          const owned = upgrade.owned;

          // Calculate different tiers
          const hundreds = Math.floor(owned / 100);
          const tens = Math.floor((owned % 100) / 10);
          const ones = owned % 10;

          const containerWidth = 350; // Approximate width of upgrade container
          let iconIndex = 0;

          // Add hundred icons (large, red gradient)
          for (let i = 0; i < hundreds; i++) {
            const position = this.getIconPosition(iconIndex, containerWidth);
            iconsHtml += `<div class="ownership-icon large" style="left: ${position.x}px; top: ${position.y}px;">üíØ</div>`;
            iconIndex++;
          }

          // Add ten icons (medium, yellow gradient)
          for (let i = 0; i < tens; i++) {
            const position = this.getIconPosition(iconIndex, containerWidth);
            iconsHtml += `<div class="ownership-icon medium" style="left: ${position.x}px; top: ${position.y}px;">üîü</div>`;
            iconIndex++;
          }

          // Add single icons (small, blue gradient)
          for (let i = 0; i < ones; i++) {
            const position = this.getIconPosition(iconIndex, containerWidth);
            iconsHtml += `<div class="ownership-icon small" style="left: ${position.x}px; top: ${position.y}px;">‚óè</div>`;
            iconIndex++;
          }

          return iconsHtml;
        }

        getIconPosition(index, containerWidth) {
          const iconsPerRow = Math.floor(containerWidth / 25); // Space icons 25px apart
          const row = Math.floor(index / iconsPerRow);
          const col = index % iconsPerRow;

          return {
            x: col * 25 + 5, // 5px margin from left
            y: row * 15 + 2, // Stack rows with 15px height, 2px from top
          };
        }

        showFloatingText(element, text, color = "#4ecdc4") {
          const rect = element.getBoundingClientRect();
          const floatingText = document.createElement("div");
          floatingText.className = "floating-text";
          floatingText.textContent = text;
          floatingText.style.color = color;
          floatingText.style.left = `${rect.left + rect.width / 2}px`;
          floatingText.style.top = `${rect.top}px`;

          document.body.appendChild(floatingText);

          setTimeout(() => {
            document.body.removeChild(floatingText);
          }, 1000);
        }

        startPointsPerSecond() {
          setInterval(() => {
            if (this.pointsPerSecond > 0) {
              this.points += this.pointsPerSecond;
              this.updateDisplay();
            }
          }, 1000);
        }

        startAutoSave() {
          setInterval(() => {
            this.saveGame();
          }, 30000); // Save every 30 seconds
        }

        saveGame() {
          const gameData = {
            points: this.points,
            pointsPerSecond: this.pointsPerSecond,
            highestEraReached: this.highestEraReached,
            luckLevel: this.luckLevel,
            efficiencyLevel: this.efficiencyLevel,
            automationLevel: this.automationLevel,
            multiplierLevel: this.multiplierLevel,
            timeWarpLevel: this.timeWarpLevel,
            prestigeCount: this.prestigeCount,
            upgrades: this.upgrades.map((u) => ({ id: u.id, owned: u.owned })),
          };
          localStorage.setItem("techClickerSave", JSON.stringify(gameData));
        }

        loadGame() {
          const saveData = localStorage.getItem("techClickerSave");
          if (saveData) {
            try {
              const data = JSON.parse(saveData);
              this.points = data.points || 0;
              this.pointsPerSecond = data.pointsPerSecond || 0;
              this.highestEraReached = data.highestEraReached || 0;
              this.luckLevel = data.luckLevel || 0;
              this.efficiencyLevel = data.efficiencyLevel || 0;
              this.automationLevel = data.automationLevel || 0;
              this.multiplierLevel = data.multiplierLevel || 0;
              this.timeWarpLevel = data.timeWarpLevel || 0;
              this.prestigeCount = data.prestigeCount || 0;

              if (data.upgrades) {
                data.upgrades.forEach((savedUpgrade) => {
                  const upgrade = this.upgrades.find(
                    (u) => u.id === savedUpgrade.id
                  );
                  if (upgrade) {
                    upgrade.owned = savedUpgrade.owned || 0;
                  }
                });
              }

              // Recalculate PPS after loading to ensure all bonuses are applied
              this.recalculatePointsPerSecond();
            } catch (e) {
              console.log("Could not load save data");
            }
          }
        }
      }

      // Start the game when the page loads
      let game; // Global reference for prestige button
      window.addEventListener("DOMContentLoaded", () => {
        game = new TechClickerGame();
      });
    </script>
  </body>
</html>
